<div class="container">
	<% if flash[:notice] %>
	<p class="notice"><%= flash[:notice] %></p>
	<% end %>
	<%= render 'devise/shared/show', user: @user, book: Book.new %>
	<% if @book.errors.any? %>
	<div class="error_explanation">
		<h2><%= pluralize(@book.errors.count, "error") %> prohibited this book from being saved:</h2>
		<ul>
			<% @book.errors.full_messages.each do |message| %>
			<li><%= message %></li>
			<% end %>
		</ul>
	</div>
	<% end %>



	<div class="col-xs-9">
		<h2>Book detail</h2>
		<table class="table">
			<tbody>
				<tr>
					<td>
						<%= link_to user_path(@user) do %>
						<%= attachment_image_tag @book.user, :profile_image, :fill, 100, 100, fallback: "no_image.jpg",size:'40x40' %><br />
						<%= @user.name %>
					</td>
					<td>
						<%= link_to @book.title, book_path(@book) %>
					</td>
					<td>
						<%= @book.body %>
						<% end %>

						<td>いいね件数: <%= @book.favorites.count %><td>
							<% if current_user.favorited_by?(@book.id) %>
								<td><%= link_to 'いいね外す', destroy_favorite_path(@book), method: :DELETE %></td>
							<% else %>
								<td><%= link_to 'いいねする', create_favorite_path(@book), method: :POST %></td>
							<% end %>

					</td>
					<% if @user.id == current_user.id %>
					<td>
						<%= link_to "Edit", edit_book_path(@book), class:"btn-sm btn-success" %>
					</td>
					<td>
						<%= link_to "Destroy", book_path(@book), method: :delete, data: {confirm: "本当に消しますか？"} ,class:"btn-sm btn-danger" %>
					</td>
					<% end %>
				</tr>
			</tbody>
		</table>
		
		<div class="col-xs-12">
				<% @book_comments.each do |book_comment| %>
						<table style="border:none;">
								<tr>
										<td>
										<%= attachment_image_tag(book_comment.user, :profile_image, :fill, 40, 40, fallback: "no_image.jpg") %><br>
										<%= book_comment.user.name %>
										<td>
										<td><%= book_comment.content %></td>
										<% if book_comment.user == current_user %>
												<td><%=link_to "Destroy",book_book_comment_path(@book, book_comment), method: :delete, class: "btn-sm btn-danger " %></td>
										<% end %>

								</tr>
						</table>
				<% end %>
		</div>
		<div class="col-xs-6">
			<div class="comment-form">
			<td>コメント件数: <%= @book.book_comments.count %> </td>
				<%= form_for [@book, @book_comment] do |f| %>
						<%= f.text_area :content, size: "95x5" %>
						<%= f.submit "送信", class: "btn-sm btn-primary" %>
				<% end %>
		</div>
	</div>
</div>

